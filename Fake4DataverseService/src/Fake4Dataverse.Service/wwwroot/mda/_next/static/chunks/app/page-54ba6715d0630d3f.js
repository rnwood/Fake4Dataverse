(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3071:(e,t,a)=>{Promise.resolve().then(a.bind(a,6310))},6310:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>B});var r=a(5155),n=a(2115),o=a(4092),i=a(4238),l=a(9616),c=a(3534),s=a(6631),d=a(784),u=a(530);let p=(0,o.n)({nav:{width:"250px",height:"100vh",backgroundColor:i.L.colorNeutralBackground3,borderRight:"1px solid ".concat(i.L.colorNeutralStroke1),display:"flex",flexDirection:"column",overflow:"hidden"},header:{padding:"16px",borderBottom:"1px solid ".concat(i.L.colorNeutralStroke1),fontWeight:i.L.fontWeightSemibold,fontSize:i.L.fontSizeBase400},scrollArea:{flex:1,overflow:"auto",padding:"8px"},areaTitle:{padding:"8px 12px",fontWeight:i.L.fontWeightSemibold,fontSize:i.L.fontSizeBase300,color:i.L.colorNeutralForeground2,textTransform:"uppercase",letterSpacing:"0.5px"},groupTitle:{padding:"4px 12px",fontWeight:i.L.fontWeightSemibold,fontSize:i.L.fontSizeBase200,color:i.L.colorNeutralForeground3},subAreaItem:{cursor:"pointer","&:hover":{backgroundColor:i.L.colorNeutralBackground1Hover}},selectedSubArea:{backgroundColor:i.L.colorNeutralBackground1Selected}});function h(e){let{areas:t,selectedEntity:a,onNavigate:n}=e,o=p();return(0,r.jsxs)("div",{className:o.nav,children:[(0,r.jsxs)("div",{className:o.header,children:[(0,r.jsx)(u.VFg,{})," Model-Driven App"]}),(0,r.jsx)("div",{className:o.scrollArea,children:t.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:o.areaTitle,children:e.title}),e.groups.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:o.groupTitle,children:e.title}),(0,r.jsx)(c.P,{"aria-label":e.title,children:e.subareas.map(e=>(0,r.jsx)(s.y,{itemType:"leaf",value:e.id,className:e.entity===a?"".concat(o.subAreaItem," ").concat(o.selectedSubArea):o.subAreaItem,children:(0,r.jsx)(d.c,{onClick:()=>{e.entity&&n&&n(e.entity)},children:e.title})},e.id))})]},e.id))]},e.id))})]})}var g=a(8745),m=a(7248),f=a(6044),x=a(711),v=a(3988),y=a(6647),b=a(2099),j=a(3889),w=a(7932),S=a(1523),N=a(5158),A=a(1221),k=a(5015),E=a(5764),C=a(7017);let L="/api/data/v9.2";class q{async fetchEntities(e,t){var a;let r=new URLSearchParams;(null==t||null==(a=t.select)?void 0:a.length)&&r.append("$select",t.select.join(",")),(null==t?void 0:t.filter)&&r.append("$filter",t.filter),(null==t?void 0:t.orderby)&&r.append("$orderby",t.orderby),(null==t?void 0:t.top)!==void 0&&r.append("$top",t.top.toString()),(null==t?void 0:t.skip)!==void 0&&r.append("$skip",t.skip.toString()),(null==t?void 0:t.count)&&r.append("$count","true");let n="".concat(L,"/").concat(e).concat(r.toString()?"?"+r.toString():""),o=await fetch(n,{method:"GET",headers:{Accept:"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"}});if(!o.ok)throw Error("API request failed: ".concat(o.status," ").concat(o.statusText));return o.json()}async fetchEntity(e,t,a){var r;let n=new URLSearchParams;(null==a||null==(r=a.select)?void 0:r.length)&&n.append("$select",a.select.join(","));let o="".concat(L,"/").concat(e,"(").concat(t,")").concat(n.toString()?"?"+n.toString():""),i=await fetch(o,{method:"GET",headers:{Accept:"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"}});if(!i.ok)throw Error("API request failed: ".concat(i.status," ").concat(i.statusText));return i.json()}async createEntity(e,t){let a="".concat(L,"/").concat(e),r=await fetch(a,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"},body:JSON.stringify(t)});if(!r.ok)throw Error("API request failed: ".concat(r.status," ").concat(r.statusText));let n=r.headers.get("Location");if(n){let e=n.match(/\(([^)]+)\)/);if(e)return e[1]}return""}async updateEntity(e,t,a){let r="".concat(L,"/").concat(e,"(").concat(t,")"),n=await fetch(r,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"},body:JSON.stringify(a)});if(!n.ok)throw Error("API request failed: ".concat(n.status," ").concat(n.statusText))}async deleteEntity(e,t){let a="".concat(L,"/").concat(e,"(").concat(t,")"),r=await fetch(a,{method:"DELETE",headers:{"OData-MaxVersion":"4.0","OData-Version":"4.0"}});if(!r.ok)throw Error("API request failed: ".concat(r.status," ").concat(r.statusText))}}let I=new q,T=(0,o.n)({container:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:i.L.colorNeutralBackground1},header:{padding:"16px 24px",borderBottom:"1px solid ".concat(i.L.colorNeutralStroke1),backgroundColor:i.L.colorNeutralBackground1},titleRow:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"12px"},title:{fontSize:i.L.fontSizeBase500,fontWeight:i.L.fontWeightSemibold},viewSwitcher:{minWidth:"200px"},toolbar:{marginBottom:"8px"},content:{flex:1,overflow:"auto",padding:"16px 24px"},loadingContainer:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},errorContainer:{padding:"24px",color:i.L.colorPaletteRedForeground1},emptyContainer:{padding:"24px",textAlign:"center",color:i.L.colorNeutralForeground3},dataGrid:{minWidth:"100%"},recordCount:{marginTop:"12px",color:i.L.colorNeutralForeground3}});function D(e){var t;let{entityName:a,entityPluralName:o,displayName:i,appModuleId:c,initialViewId:s}=e,d=T(),[u,p]=(0,n.useState)([]),[h,L]=(0,n.useState)(!0),[q,D]=(0,n.useState)(null),[O,M]=(0,n.useState)([]),[P,B]=(0,n.useState)([]),[F,V]=(0,n.useState)(s||null),[z,W]=(0,n.useState)(!0);(0,n.useEffect)(()=>{R()},[a,c]),(0,n.useEffect)(()=>{F&&U()},[F,o]);let R=async()=>{W(!0);try{let e="returnedtypecode eq '".concat(a,"'");if(c)try{let t=await I.fetchEntities("appmodulecomponents",{filter:"appmoduleidunique eq ".concat(c," and componenttype eq 26"),select:["objectid"]});if(t.value.length>0){let a=t.value.map(e=>e.objectid).filter(e=>e);if(a.length>0){let t=a.map(e=>"savedqueryid eq ".concat(e)).join(" or ");e="(".concat(e,") and (").concat(t,")")}}}catch(e){console.warn("Failed to load app module components, showing all views:",e)}let t=(await I.fetchEntities("savedqueries",{filter:e,select:["savedqueryid","name","returnedtypecode","fetchxml","layoutxml","isdefault"],orderby:"isdefault desc,name asc"})).value;if(B(t),t.length>0){let e;s&&(e=t.find(e=>e.savedqueryid===s)),e||(e=t.find(e=>e.isdefault)||t[0]),V(e.savedqueryid)}}catch(e){console.error("Error loading views:",e),B([]),V(null)}finally{W(!1)}},U=async()=>{L(!0),D(null);try{let e,t,a=P.find(e=>e.savedqueryid===F),r=[];if((null==a?void 0:a.layoutxml)&&(r=_(a.layoutxml)),null==a?void 0:a.fetchxml){let r=$(a.fetchxml);e=r.filter,t=r.orderby}let n={top:50,count:!0};r.length>0&&(n.select=r),e&&(n.filter=e),t&&(n.orderby=t);let i=await I.fetchEntities(o,n);if(p(i.value),i.value.length>0){let e,t=[];if(r.length>0)e=r;else{let t=i.value[0];e=Object.keys(t).filter(e=>!e.startsWith("@")&&!e.startsWith("_")).slice(0,6)}e.forEach(e=>{t.push((0,g.r)({columnId:e,compare:(t,a)=>{let r=String(t[e]||""),n=String(a[e]||"");return r.localeCompare(n)},renderHeaderCell:()=>G(e),renderCell:t=>{let a=t[e];return null==a?"":"object"==typeof a?a.Name?a.Name:void 0!==a.Value?String(a.Value):JSON.stringify(a):String(a)}}))}),M(t)}}catch(e){D(e instanceof Error?e.message:"Failed to load records"),console.error("Error loading records:",e)}finally{L(!1)}},_=e=>{try{let t=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("cell"),a=[];for(let e=0;e<t.length;e++){let r=t[e].getAttribute("name");r&&a.push(r)}return a}catch(e){return console.error("Error parsing layoutxml:",e),[]}},$=e=>{try{let t=new DOMParser().parseFromString(e,"text/xml"),a={},r=t.getElementsByTagName("filter")[0];if(r){let e=r.getElementsByTagName("condition"),t=[];for(let a=0;a<e.length;a++){let r=e[a],n=r.getAttribute("attribute"),o=r.getAttribute("operator"),i=r.getAttribute("value");if(n&&o){let e="";switch(o){case"eq":e="".concat(n," eq ").concat(null!==i?"'".concat(i,"'"):"null");break;case"ne":e="".concat(n," ne ").concat(null!==i?"'".concat(i,"'"):"null");break;case"gt":e="".concat(n," gt ").concat(i);break;case"ge":e="".concat(n," ge ").concat(i);break;case"lt":e="".concat(n," lt ").concat(i);break;case"le":e="".concat(n," le ").concat(i);break;case"like":e="contains(".concat(n,", '").concat(i,"')");break;case"not-like":e="not contains(".concat(n,", '").concat(i,"')");break;case"null":e="".concat(n," eq null");break;case"not-null":e="".concat(n," ne null");break;default:console.warn("Unsupported FetchXML operator: ".concat(o))}e&&t.push(e)}}let n=r.getAttribute("type")||"and";t.length>0&&(a.filter=t.join(" ".concat(n," ")))}let n=t.getElementsByTagName("order");if(n.length>0){let e=[];for(let t=0;t<n.length;t++){let a=n[t],r=a.getAttribute("attribute"),o="true"===a.getAttribute("descending");r&&e.push("".concat(r," ").concat(o?"desc":"asc"))}e.length>0&&(a.orderby=e.join(","))}return a}catch(e){return console.error("Error parsing FetchXML:",e),{}}},G=e=>(e.endsWith("id")&&(e=e.substring(0,e.length-2)),e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim());return(0,r.jsxs)("div",{className:d.container,children:[(0,r.jsxs)("div",{className:d.header,children:[(0,r.jsxs)("div",{className:d.titleRow,children:[(0,r.jsx)("div",{className:d.title,children:i||a}),z?(0,r.jsx)(l.y,{size:"tiny"}):P.length>0&&(0,r.jsx)(m.m,{className:d.viewSwitcher,value:(null==(t=P.find(e=>e.savedqueryid===F))?void 0:t.name)||"",selectedOptions:F?[F]:[],onOptionSelect:(e,t)=>(e=>{if(V(e),c){let t=new URLSearchParams(window.location.search);t.set("viewid",e);let a="".concat(window.location.pathname,"?").concat(t.toString());window.history.pushState({},"",a)}})(t.optionValue),placeholder:"Select view",children:P.map(e=>(0,r.jsx)(f.c,{value:e.savedqueryid,children:e.name},e.savedqueryid))})]}),(0,r.jsxs)(x.M,{className:d.toolbar,children:[(0,r.jsx)(v.I,{icon:(0,r.jsx)(k.Zc_,{}),onClick:U,disabled:h||!F,children:"Refresh"}),(0,r.jsx)(v.I,{icon:(0,r.jsx)(E.Eu3,{}),disabled:!0,children:"New"}),(0,r.jsx)(v.I,{icon:(0,r.jsx)(C.Hs1,{}),disabled:!0,children:"Filter"})]})]}),(0,r.jsxs)("div",{className:d.content,children:[h&&(0,r.jsx)("div",{className:d.loadingContainer,children:(0,r.jsx)(l.y,{label:"Loading records..."})}),q&&!h&&(0,r.jsxs)("div",{className:d.errorContainer,children:[(0,r.jsx)("strong",{children:"Error:"})," ",q]}),!h&&!q&&!F&&0===P.length&&(0,r.jsx)("div",{className:d.emptyContainer,children:"No views available for this entity"}),!h&&!q&&0===u.length&&F&&(0,r.jsx)("div",{className:d.emptyContainer,children:"No records found"}),!h&&!q&&u.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.z,{items:u,columns:O,sortable:!0,getRowId:e=>e[a+"id"]||JSON.stringify(e),className:d.dataGrid,children:[(0,r.jsx)(b.C,{children:(0,r.jsx)(j.r,{children:e=>{let{renderHeaderCell:t}=e;return(0,r.jsx)(w._,{children:t()})}})}),(0,r.jsx)(S.V,{children:e=>{let{item:t,rowId:a}=e;return(0,r.jsx)(j.r,{children:e=>{let{renderCell:a}=e;return(0,r.jsx)(N.N,{children:a(t)})}},a)}})]}),(0,r.jsxs)(A.M,{className:d.recordCount,children:["Showing ",u.length," records"]})]})]})]})}let O=(0,o.n)({container:{display:"flex",height:"100vh",overflow:"hidden"},main:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},loadingContainer:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:i.L.colorNeutralBackground1},errorContainer:{padding:"24px",color:i.L.colorPaletteRedForeground1,backgroundColor:i.L.colorNeutralBackground1},welcomeContainer:{padding:"24px",backgroundColor:i.L.colorNeutralBackground1}}),M={account:"accounts",contact:"contacts",opportunity:"opportunities",lead:"leads",incident:"incidents",knowledgearticle:"knowledgearticles",systemuser:"systemusers",team:"teams"},P={account:"Accounts",contact:"Contacts",opportunity:"Opportunities",lead:"Leads",incident:"Cases",knowledgearticle:"Knowledge Articles",systemuser:"Users",team:"Teams"};function B(){let e=O(),[t,a]=(0,n.useState)(null),[o,i]=(0,n.useState)(!0),[c,s]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[p,g]=(0,n.useState)(null),[m,f]=(0,n.useState)(void 0);(0,n.useEffect)(()=>{x()},[]);let x=async()=>{i(!0),s(null);try{let e=function(){let e=new URLSearchParams(window.location.search);return{appid:e.get("appid")||void 0,pagetype:e.get("pagetype")||void 0,etn:e.get("etn")||void 0,viewid:e.get("viewid")||void 0}}(),t=await I.fetchEntities("appmodules",{top:1,select:["appmoduleid","name"],...e.appid&&{filter:"appmoduleid eq ".concat(e.appid)}});if(t.value.length>0){let r=t.value[0];g(r.appmoduleid);let n=await I.fetchEntities("sitemaps",{filter:"appmoduleid eq ".concat(r.appmoduleid),select:["sitemapid","sitemapxml"],top:1});if(n.value.length>0){let t=n.value[0];if(t.sitemapxml){let r=function(e){try{let t=new DOMParser().parseFromString(e,"text/xml"),a=[];return t.querySelectorAll("SiteMap > Area").forEach(e=>{let t={id:e.getAttribute("Id")||"",title:e.getAttribute("Title")||e.getAttribute("Id")||"Untitled",icon:e.getAttribute("Icon")||void 0,groups:[]};e.querySelectorAll(":scope > Group").forEach(e=>{let a={id:e.getAttribute("Id")||"",title:e.getAttribute("Title")||e.getAttribute("Id")||"Untitled",subareas:[]};e.querySelectorAll(":scope > SubArea").forEach(e=>{let t={id:e.getAttribute("Id")||"",title:e.getAttribute("Title")||e.getAttribute("Id")||"Untitled",entity:e.getAttribute("Entity")||void 0,url:e.getAttribute("Url")||void 0,icon:e.getAttribute("Icon")||void 0};a.subareas.push(t)}),t.groups.push(a)}),a.push(t)}),{areas:a}}catch(e){return console.error("Error parsing sitemap XML:",e),{areas:[]}}}(t.sitemapxml);if(a(r),e.etn)u(e.etn),f(e.viewid);else if(r.areas.length>0){let e=r.areas[0];if(e.groups.length>0){let t=e.groups[0];if(t.subareas.length>0){let e=t.subareas[0];e.entity&&u(e.entity)}}}}}else s("No sitemap found for the app. Please initialize MDA data.")}else s("No app module found. Please initialize MDA data using the CLI service.")}catch(e){console.error("Error loading sitemap:",e),s(e instanceof Error?e.message:"Failed to load sitemap")}finally{i(!1)}};return o?(0,r.jsx)("div",{className:e.loadingContainer,children:(0,r.jsx)(l.y,{label:"Loading Model-Driven App..."})}):c?(0,r.jsxs)("div",{className:e.errorContainer,children:[(0,r.jsx)("h2",{children:"Error Loading App"}),(0,r.jsx)("p",{children:c}),(0,r.jsx)("p",{children:"Make sure the Fake4Dataverse service is running and has initialized MDA metadata."})]}):t&&0!==t.areas.length?(0,r.jsxs)("div",{className:e.container,children:[(0,r.jsx)(h,{areas:t.areas,selectedEntity:d||void 0,onNavigate:e=>{if(u(e),f(void 0),p){let t=new URLSearchParams;t.set("appid",p),t.set("pagetype","entitylist"),t.set("etn",e);let a="".concat(window.location.pathname,"?").concat(t.toString());window.history.pushState({},"",a)}}}),(0,r.jsx)("main",{className:e.main,children:d?(0,r.jsx)(D,{entityName:d,entityPluralName:M[d]||d+"s",displayName:P[d],appModuleId:p||void 0,initialViewId:m}):(0,r.jsx)("div",{className:e.welcomeContainer,children:(0,r.jsx)("h2",{children:"Select an entity from the navigation"})})})]}):(0,r.jsxs)("div",{className:e.welcomeContainer,children:[(0,r.jsx)("h2",{children:"Welcome to Fake4Dataverse Model-Driven App"}),(0,r.jsx)("p",{children:"No sitemap configured. Please initialize MDA data."})]})}}},e=>{e.O(0,[288,991,184,751,651,101,7,120,876,348,342,441,255,358],()=>e(e.s=3071)),_N_E=e.O()}]);