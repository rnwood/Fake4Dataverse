(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3071:(e,t,a)=>{Promise.resolve().then(a.bind(a,6310))},6310:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>B});var r=a(5155),n=a(2115),i=a(4092),l=a(4238),o=a(9616),s=a(3534),c=a(6631),d=a(784),u=a(530);let p=(0,i.n)({nav:{width:"250px",height:"100vh",backgroundColor:l.L.colorNeutralBackground3,borderRight:"1px solid ".concat(l.L.colorNeutralStroke1),display:"flex",flexDirection:"column",overflow:"hidden"},header:{padding:"16px",borderBottom:"1px solid ".concat(l.L.colorNeutralStroke1),fontWeight:l.L.fontWeightSemibold,fontSize:l.L.fontSizeBase400},scrollArea:{flex:1,overflow:"auto",padding:"8px"},areaTitle:{padding:"8px 12px",fontWeight:l.L.fontWeightSemibold,fontSize:l.L.fontSizeBase300,color:l.L.colorNeutralForeground2,textTransform:"uppercase",letterSpacing:"0.5px"},groupTitle:{padding:"4px 12px",fontWeight:l.L.fontWeightSemibold,fontSize:l.L.fontSizeBase200,color:l.L.colorNeutralForeground3},subAreaItem:{cursor:"pointer","&:hover":{backgroundColor:l.L.colorNeutralBackground1Hover}},selectedSubArea:{backgroundColor:l.L.colorNeutralBackground1Selected}});function h(e){let{areas:t,selectedEntity:a,onNavigate:n}=e,i=p();return(0,r.jsxs)("div",{className:i.nav,children:[(0,r.jsxs)("div",{className:i.header,children:[(0,r.jsx)(u.VFg,{})," Model-Driven App"]}),(0,r.jsx)("div",{className:i.scrollArea,children:t.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:i.areaTitle,children:e.title}),e.groups.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:i.groupTitle,children:e.title}),(0,r.jsx)(s.P,{"aria-label":e.title,children:e.subareas.map(e=>(0,r.jsx)(c.y,{itemType:"leaf",value:e.id,className:e.entity===a?"".concat(i.subAreaItem," ").concat(i.selectedSubArea):i.subAreaItem,children:(0,r.jsx)(d.c,{onClick:()=>{e.entity&&n&&n(e.entity)},children:e.title})},e.id))})]},e.id))]},e.id))})]})}var g=a(8745),m=a(7248),f=a(6044),x=a(711),v=a(3988),y=a(6647),j=a(2099),b=a(3889),N=a(7932),S=a(1523),w=a(5158),A=a(1221),E=a(5015),C=a(5764),k=a(7017);let L="/api/data/v9.2";class I{async fetchEntities(e,t){var a;let r=new URLSearchParams;(null==t||null==(a=t.select)?void 0:a.length)&&r.append("$select",t.select.join(",")),(null==t?void 0:t.filter)&&r.append("$filter",t.filter),(null==t?void 0:t.orderby)&&r.append("$orderby",t.orderby),(null==t?void 0:t.top)!==void 0&&r.append("$top",t.top.toString()),(null==t?void 0:t.skip)!==void 0&&r.append("$skip",t.skip.toString()),(null==t?void 0:t.count)&&r.append("$count","true");let n="".concat(L,"/").concat(e).concat(r.toString()?"?"+r.toString():""),i=await fetch(n,{method:"GET",headers:{Accept:"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"}});if(!i.ok)throw Error("API request failed: ".concat(i.status," ").concat(i.statusText));return i.json()}async fetchEntity(e,t,a){var r;let n=new URLSearchParams;(null==a||null==(r=a.select)?void 0:r.length)&&n.append("$select",a.select.join(","));let i="".concat(L,"/").concat(e,"(").concat(t,")").concat(n.toString()?"?"+n.toString():""),l=await fetch(i,{method:"GET",headers:{Accept:"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"}});if(!l.ok)throw Error("API request failed: ".concat(l.status," ").concat(l.statusText));return l.json()}async createEntity(e,t){let a="".concat(L,"/").concat(e),r=await fetch(a,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"},body:JSON.stringify(t)});if(!r.ok)throw Error("API request failed: ".concat(r.status," ").concat(r.statusText));let n=r.headers.get("Location");if(n){let e=n.match(/\(([^)]+)\)/);if(e)return e[1]}return""}async updateEntity(e,t,a){let r="".concat(L,"/").concat(e,"(").concat(t,")"),n=await fetch(r,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"},body:JSON.stringify(a)});if(!n.ok)throw Error("API request failed: ".concat(n.status," ").concat(n.statusText))}async deleteEntity(e,t){let a="".concat(L,"/").concat(e,"(").concat(t,")"),r=await fetch(a,{method:"DELETE",headers:{"OData-MaxVersion":"4.0","OData-Version":"4.0"}});if(!r.ok)throw Error("API request failed: ".concat(r.status," ").concat(r.statusText))}}let D=new I,T=(0,i.n)({container:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:l.L.colorNeutralBackground1},header:{padding:"16px 24px",borderBottom:"1px solid ".concat(l.L.colorNeutralStroke1),backgroundColor:l.L.colorNeutralBackground1},titleRow:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"12px"},title:{fontSize:l.L.fontSizeBase500,fontWeight:l.L.fontWeightSemibold},viewSwitcher:{minWidth:"200px"},toolbar:{marginBottom:"8px"},content:{flex:1,overflow:"auto",padding:"16px 24px"},loadingContainer:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},errorContainer:{padding:"24px",color:l.L.colorPaletteRedForeground1},emptyContainer:{padding:"24px",textAlign:"center",color:l.L.colorNeutralForeground3},dataGrid:{minWidth:"100%"},recordCount:{marginTop:"12px",color:l.L.colorNeutralForeground3}});function O(e){var t;let{entityName:a,entityPluralName:i,displayName:l,appModuleId:s}=e,c=T(),[d,u]=(0,n.useState)([]),[p,h]=(0,n.useState)(!0),[L,I]=(0,n.useState)(null),[O,q]=(0,n.useState)([]),[M,P]=(0,n.useState)([]),[B,F]=(0,n.useState)(null),[V,z]=(0,n.useState)(!0);(0,n.useEffect)(()=>{W()},[a,s]),(0,n.useEffect)(()=>{B&&R()},[B,i]);let W=async()=>{z(!0);try{let e="returnedtypecode eq '".concat(a,"'");if(s)try{let t=await D.fetchEntities("appmodulecomponents",{filter:"appmoduleidunique eq ".concat(s," and componenttype eq 26"),select:["objectid"]});if(t.value.length>0){let a=t.value.map(e=>e.objectid).filter(e=>e);if(a.length>0){let t=a.map(e=>"savedqueryid eq ".concat(e)).join(" or ");e="(".concat(e,") and (").concat(t,")")}}}catch(e){console.warn("Failed to load app module components, showing all views:",e)}let t=(await D.fetchEntities("savedqueries",{filter:e,select:["savedqueryid","name","returnedtypecode","fetchxml","layoutxml","isdefault"],orderby:"isdefault desc,name asc"})).value;if(P(t),t.length>0){let e=t.find(e=>e.isdefault)||t[0];F(e.savedqueryid)}}catch(e){console.error("Error loading views:",e),P([]),F(null)}finally{z(!1)}},R=async()=>{h(!0),I(null);try{let e=M.find(e=>e.savedqueryid===B),t=[];(null==e?void 0:e.layoutxml)&&(t=_(e.layoutxml));let a={top:50,count:!0};t.length>0&&(a.select=t);let r=await D.fetchEntities(i,a);if(u(r.value),r.value.length>0){let e,a=[];if(t.length>0)e=t;else{let t=r.value[0];e=Object.keys(t).filter(e=>!e.startsWith("@")&&!e.startsWith("_")).slice(0,6)}e.forEach(e=>{a.push((0,g.r)({columnId:e,compare:(t,a)=>{let r=String(t[e]||""),n=String(a[e]||"");return r.localeCompare(n)},renderHeaderCell:()=>U(e),renderCell:t=>{let a=t[e];return null==a?"":"object"==typeof a?a.Name?a.Name:void 0!==a.Value?String(a.Value):JSON.stringify(a):String(a)}}))}),q(a)}}catch(e){I(e instanceof Error?e.message:"Failed to load records"),console.error("Error loading records:",e)}finally{h(!1)}},_=e=>{try{let t=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("cell"),a=[];for(let e=0;e<t.length;e++){let r=t[e].getAttribute("name");r&&a.push(r)}return a}catch(e){return console.error("Error parsing layoutxml:",e),[]}},U=e=>(e.endsWith("id")&&(e=e.substring(0,e.length-2)),e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim());return(0,r.jsxs)("div",{className:c.container,children:[(0,r.jsxs)("div",{className:c.header,children:[(0,r.jsxs)("div",{className:c.titleRow,children:[(0,r.jsx)("div",{className:c.title,children:l||a}),V?(0,r.jsx)(o.y,{size:"tiny"}):M.length>0&&(0,r.jsx)(m.m,{className:c.viewSwitcher,value:(null==(t=M.find(e=>e.savedqueryid===B))?void 0:t.name)||"",selectedOptions:B?[B]:[],onOptionSelect:(e,t)=>F(t.optionValue),placeholder:"Select view",children:M.map(e=>(0,r.jsx)(f.c,{value:e.savedqueryid,children:e.name},e.savedqueryid))})]}),(0,r.jsxs)(x.M,{className:c.toolbar,children:[(0,r.jsx)(v.I,{icon:(0,r.jsx)(E.Zc_,{}),onClick:R,disabled:p||!B,children:"Refresh"}),(0,r.jsx)(v.I,{icon:(0,r.jsx)(C.Eu3,{}),disabled:!0,children:"New"}),(0,r.jsx)(v.I,{icon:(0,r.jsx)(k.Hs1,{}),disabled:!0,children:"Filter"})]})]}),(0,r.jsxs)("div",{className:c.content,children:[p&&(0,r.jsx)("div",{className:c.loadingContainer,children:(0,r.jsx)(o.y,{label:"Loading records..."})}),L&&!p&&(0,r.jsxs)("div",{className:c.errorContainer,children:[(0,r.jsx)("strong",{children:"Error:"})," ",L]}),!p&&!L&&!B&&0===M.length&&(0,r.jsx)("div",{className:c.emptyContainer,children:"No views available for this entity"}),!p&&!L&&0===d.length&&B&&(0,r.jsx)("div",{className:c.emptyContainer,children:"No records found"}),!p&&!L&&d.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.z,{items:d,columns:O,sortable:!0,getRowId:e=>e[a+"id"]||JSON.stringify(e),className:c.dataGrid,children:[(0,r.jsx)(j.C,{children:(0,r.jsx)(b.r,{children:e=>{let{renderHeaderCell:t}=e;return(0,r.jsx)(N._,{children:t()})}})}),(0,r.jsx)(S.V,{children:e=>{let{item:t,rowId:a}=e;return(0,r.jsx)(b.r,{children:e=>{let{renderCell:a}=e;return(0,r.jsx)(w.N,{children:a(t)})}},a)}})]}),(0,r.jsxs)(A.M,{className:c.recordCount,children:["Showing ",d.length," records"]})]})]})]})}let q=(0,i.n)({container:{display:"flex",height:"100vh",overflow:"hidden"},main:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},loadingContainer:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:l.L.colorNeutralBackground1},errorContainer:{padding:"24px",color:l.L.colorPaletteRedForeground1,backgroundColor:l.L.colorNeutralBackground1},welcomeContainer:{padding:"24px",backgroundColor:l.L.colorNeutralBackground1}}),M={account:"accounts",contact:"contacts",opportunity:"opportunities",lead:"leads",incident:"incidents",knowledgearticle:"knowledgearticles",systemuser:"systemusers",team:"teams"},P={account:"Accounts",contact:"Contacts",opportunity:"Opportunities",lead:"Leads",incident:"Cases",knowledgearticle:"Knowledge Articles",systemuser:"Users",team:"Teams"};function B(){let e=q(),[t,a]=(0,n.useState)(null),[i,l]=(0,n.useState)(!0),[s,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[p,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{m()},[]);let m=async()=>{l(!0),c(null);try{let e=await D.fetchEntities("appmodules",{top:1,select:["appmoduleid","name"]});if(e.value.length>0){let t=e.value[0];g(t.appmoduleid);let r=await D.fetchEntities("sitemaps",{filter:"appmoduleid eq ".concat(t.appmoduleid),select:["sitemapid","sitemapxml"],top:1});if(r.value.length>0){let e=r.value[0];if(e.sitemapxml){let t=function(e){try{let t=new DOMParser().parseFromString(e,"text/xml"),a=[];return t.querySelectorAll("SiteMap > Area").forEach(e=>{let t={id:e.getAttribute("Id")||"",title:e.getAttribute("Title")||e.getAttribute("Id")||"Untitled",icon:e.getAttribute("Icon")||void 0,groups:[]};e.querySelectorAll(":scope > Group").forEach(e=>{let a={id:e.getAttribute("Id")||"",title:e.getAttribute("Title")||e.getAttribute("Id")||"Untitled",subareas:[]};e.querySelectorAll(":scope > SubArea").forEach(e=>{let t={id:e.getAttribute("Id")||"",title:e.getAttribute("Title")||e.getAttribute("Id")||"Untitled",entity:e.getAttribute("Entity")||void 0,url:e.getAttribute("Url")||void 0,icon:e.getAttribute("Icon")||void 0};a.subareas.push(t)}),t.groups.push(a)}),a.push(t)}),{areas:a}}catch(e){return console.error("Error parsing sitemap XML:",e),{areas:[]}}}(e.sitemapxml);if(a(t),t.areas.length>0){let e=t.areas[0];if(e.groups.length>0){let t=e.groups[0];if(t.subareas.length>0){let e=t.subareas[0];e.entity&&u(e.entity)}}}}}else c("No sitemap found for the app. Please initialize MDA data.")}else c("No app module found. Please initialize MDA data using the CLI service.")}catch(e){console.error("Error loading sitemap:",e),c(e instanceof Error?e.message:"Failed to load sitemap")}finally{l(!1)}};return i?(0,r.jsx)("div",{className:e.loadingContainer,children:(0,r.jsx)(o.y,{label:"Loading Model-Driven App..."})}):s?(0,r.jsxs)("div",{className:e.errorContainer,children:[(0,r.jsx)("h2",{children:"Error Loading App"}),(0,r.jsx)("p",{children:s}),(0,r.jsx)("p",{children:"Make sure the Fake4Dataverse service is running and has initialized MDA metadata."})]}):t&&0!==t.areas.length?(0,r.jsxs)("div",{className:e.container,children:[(0,r.jsx)(h,{areas:t.areas,selectedEntity:d||void 0,onNavigate:u}),(0,r.jsx)("main",{className:e.main,children:d?(0,r.jsx)(O,{entityName:d,entityPluralName:M[d]||d+"s",displayName:P[d],appModuleId:p||void 0}):(0,r.jsx)("div",{className:e.welcomeContainer,children:(0,r.jsx)("h2",{children:"Select an entity from the navigation"})})})]}):(0,r.jsxs)("div",{className:e.welcomeContainer,children:[(0,r.jsx)("h2",{children:"Welcome to Fake4Dataverse Model-Driven App"}),(0,r.jsx)("p",{children:"No sitemap configured. Please initialize MDA data."})]})}}},e=>{e.O(0,[288,991,184,751,651,101,7,120,876,348,342,441,255,358],()=>e(e.s=3071)),_N_E=e.O()}]);